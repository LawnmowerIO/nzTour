!function(){var t=angular.module("nzTour",[]);t.factory("nzTour",["$q","$rootScope","$compile","$timeout",function(t,e,r,o){function n(t){if(!t)throw"No Tour Specified!";if(!t.steps.length)throw"No steps were found in that tour!";return z.current?i().then(function(){return a(t)}):a(t)}function i(){return d(!1).then(b)}function u(){z.current&&w()}function s(){return z.current||z.current.reject(),g().then(v).then(m).then(f)}function c(){return g().then(function(){return z.current.step>0?(z.current.step--,!0):t.reject()}).then(f)}function l(e){var r=t.defer();return e>0&&e<=z.current.tour.steps.length?(z.current.step=e-2,f(!0)):(r.reject(),r.promise)}function a(e){return e.config=angular.extendDeep({},z.config,e.config),console.log(e),z.current={tour:e,step:0,promise:t.defer()},d(!0,e),f(),z.current.promise.promise}function d(e){var n=t.defer();return e?(z.box=angular.element(r('<nz-tour class="hidden"></nz-tour>')(z)),angular.element(z.body).append(z.box),o(function(){z.box.removeClass("hidden")},10),n.resolve()):(z.box.addClass("hidden"),o(function(){z.box.remove(),z.$broadcast("remove"),n.resolve()},z.current.tour.config.animationDuration)),n.promise}function f(){return h().then(p)}function h(){var e=t.defer();return z.current.tour.steps[z.current.step].before?z.current.tour.steps[z.current.step].before():(e.resolve(),e.promise)}function p(){var e=t.defer();return z.$broadcast("step",z.current.step),e.resolve(),e.promise}function g(){var e=t.defer();return z.current.tour.steps[z.current.step].after?z.current.tour.steps[z.current.step].after():(e.resolve(),e.promise)}function v(){var e=t.defer();return z.current.step==z.current.tour.steps.length-1&&(x(),e.reject()),e.resolve(),e.promise}function m(){var e=t.defer();return z.current.step++,e.resolve(),e.promise}function x(){d(!1).then(function(){return z.current.promise.resolve(),z.current=!1,!0})}function b(){return z.current.promise.reject(),z.current=!1,!0}function w(){}function T(t,e){var r=!1;return function(){r||(t.call(),r=!0,o(function(){r=!1},e))}}var z=e.$new();return angular.extend(z,{config:{mask:{visible:!0,clickThrough:!1,clickExit:!1,scrollThrough:!0,color:"rgba(0,0,0,.7)"},dark:!1,scrollBox:"body",previousText:"Previous",nextText:"Next",finishText:"Finish",animationDuration:400},current:!1,body:angular.element("body"),box:!1,start:n,stop:i,pause:u,next:s,previous:c,gotoStep:l,throttle:T}),window.nzTour=z,z}]),t.directive("nzTour",["$q","$timeout","$window",function(t,e,r){return{template:['<div id="nzTour-box-wrap">','   <div id="nzTour-box">','        <div id="nzTour-tip" class="top center"></div>','        <div id="nzTour-step">{{view.step + 1}}</div>','        <div id="nzTour-length">{{view.length}}</div>','        <div id="nzTour-close" ng-click="stop()">&#10005</div>','        <div id="nzTour-content">','           <div id="nzTour-inner-content">{{view.content}}</div>',"        </div>",'        <div id="nzTour-actions">','            <button id="nzTour-previous" ng-show="view.step > 0" ng-click="previous()" class="ng-hide">{{view.previousText}}</button>','            <button id="nzTour-next" ng-show="view.step >= 0" ng-click="next()" class="success" class="ng-hide">{{view.nextText}}</button>',"        </div>","    </div>","</div>",'<div class="nzTour-masks" ng-show="current.tour.config.mask.visible" ng-click="tryStop()">','    <div class="mask top"></div>','    <div class="mask right"></div>','    <div class="mask bottom"></div>','    <div class="mask left"></div>',"</div>"].join(" "),link:function(o,n){function i(t){return t.stopPropagation(t),t.preventDefault(t),t.returnValue=!1,!1}function u(t){var e=b.add(w).add(T).add(x.top).add(x.right).add(x.bottom).add(x.left);t?e.css("transition","all "+o.current.tour.config.animationDuration+"ms ease"):e.css("transition","none")}function s(){D||o.view&&l(null,o.view.step,!0)}function c(t){function e(t){return t.stopPropagation(t),t.preventDefault(t),t.returnValue=!1,!1}var r="DOMMouseScroll"==t.type?-40*t.originalEvent.detail:t.originalEvent.wheelDelta,o=r>0,n=z.scrollTop();return o&&!n?e(t):o||k.height()-z.height()!=n?void 0:e(t)}function l(t,e,r){return r?u(!1):(o.view={step:e,length:o.current.tour.steps.length,previousText:o.current.tour.config.previousText,nextText:e==o.current.tour.steps.length-1?o.current.tour.config.finishText:o.current.tour.config.nextText},z.html(o.current.tour.steps[e].content),z.scrollTop(0)),a(o.current.tour.steps[e].target).then(d).then(f)}function a(e){var r=t.defer(),o=angular.element(e);return r.resolve(o.length?angular.element(o[0]):!1),r.promise}function d(e){function r(){return console.log(c,a,f,l),e.outerHeight()>s?a>c+s?!1:c>f?!1:f>=l||c>=a:l>=f&&a>=c}function n(){var r=t.defer();D=!0;var n;return d>s?(a>c+s&&(n=a-s/2),c>f&&(n=a+d-s/2)):n=a-M,angular.element(m).animate({scrollTop:n},o.current.tour.config.animationDuration,function(){r.resolve(e),D=!1,u(!0)}),r.promise}var i=t.defer();if(!e)return i.resolve(),i.promise;var s=v.height()-m.offset().top,c=m.scrollTop(),l=c+s,a=e.offset().top,d=e.outerHeight(),f=a+d;return r(e)?(i.resolve(e),i.resolve(e),i.promise):n(e)}function f(r){u(!0);var n=t.defer();if(!r)return p(),void g();var i=h(r);return p(i),g(i),e(function(){n.resolve()},o.current.tour.config.animationDuration),n.promise}function h(t){var e={top:t.offset().top-m.scrollTop()+m.offset().top,left:t.offset().left-m.scrollLeft()+m.offset().left,width:t.outerWidth(),height:t.outerHeight()},r={width:v.width(),height:v.height()-m.offset().top};return{width:e.width,height:e.height,top:e.top,left:e.left,bottom:r.height-e.top-e.height,right:r.width-e.left-e.width}}function p(t){function e(e,r){var o,n,i,u,s;"top"==e?(o=t.top-M,s="bottom",u="-100%"):(o=t.top+t.height+M,s="top",u="0"),"right"==r?(n=t.left+t.width,i="-100%"):"center"==r?(n=t.left+t.width/2,i="-50%"):(n=t.left,i="0"),b.css({left:n+"px",top:o+"px",transform:"translate("+i+","+u+")"}),T.attr("class",s+" "+r)}function r(e,r){var o,n,i,u,s;"right"==e?(n=t.left+t.width+M,s="left",i="0"):(n=t.left-M,s="right",i="-100%"),"top"==r?(o=t.top,u="0"):"center"==r?(o=t.top+t.height/2,u="-50%"):(o=t.top+t.height,u="-100%"),b.css({left:n+"px",top:o+"px",transform:"translate("+i+","+u+")"}),T.attr("class","side "+s+" "+r)}function o(e,r){var o,n,i,u;"top"==e?(o=t.top+M,i="0"):(o=t.top+t.height-M-(t.bottom<0?-t.bottom:0),i="-100%"),"right"==r?(n=t.left+t.width-M,u="-100%"):"center"==r?(n=t.left+t.width/2,u="-50%"):(n=t.left+M,u="0"),b.css({left:n+"px",top:o+"px",transform:"translate("+u+","+i+")"}),T.attr("class","hidden")}function n(){b.css({left:"50%",top:"50%",transform:"translate(-50%, -50%)",margin:"0"}),T.attr("class","hidden")}return t?t.bottom>135?t.width>250?void e("bottom","center"):t.right+t.width>250?void e("bottom","left"):void e("bottom","right"):t.right>250?t.height>135?void r("right","center"):t.bottom+t.height>135?void r("right","top"):void r("right","bottom"):t.left>250?t.height>135?void r("left","center"):t.bottom+t.height>135?void r("left","top"):void r("left","bottom"):t.top>135?t.width>250?void e("top","center"):t.right+t.width>250?void e("top","left"):void e("top","right"):void o("bottom","center"):void n()}function g(t){return t?(x.top.css({height:t.top+"px"}),x.bottom.css({height:t.bottom+"px"}),x.left.css({top:t.top+"px",height:t.height+"px",width:t.left+"px"}),void x.right.css({top:t.top+"px",height:t.height+"px",width:t.right+"px"})):(x.top.css({height:"0px"}),x.bottom.css({height:"0px"}),x.left.css({top:"0px",height:"100%",width:"0px"}),void x.right.css({top:"0px",height:"100%",width:"0px"}))}var v=angular.element(window),m=angular.element(o.current.tour.config.scrollBox),x={all:n.find(".nzTour-masks"),top:n.find(".nzTour-masks .top"),right:n.find(".nzTour-masks .right"),bottom:n.find(".nzTour-masks .bottom"),left:n.find(".nzTour-masks .left")},b=n.find("#nzTour-box-wrap"),w=n.find("#nzTour-box"),T=n.find("#nzTour-tip"),z=(n.find("#nzTour-step"),n.find("#nzTour-close"),n.find("#nzTour-content")),k=n.find("#nzTour-inner-content"),D=(n.find("#nzTour-actions"),n.find("#nzTour-previous"),n.find("#nzTour-next"),!1),M=15;u(!0),x.all.css("pointer-events",o.current.tour.config.mask.clickThrough?"none":"all"),o.current.tour.config.dark&&(w.addClass("dark-box"),M=7),x.top.add(x.right).add(x.bottom).add(x.left).css({"background-color":o.current.tour.config.mask.color}),o.current.tour.config.mask.scrollThrough===!1&&x.all.bind("DOMMouseScroll mousewheel scroll",i),o.$on("step",l);var $=o.throttle(s,14);angular.element(r).bind("resize DOMMouseScroll mousewheel scroll",$),z.bind("DOMMouseScroll mousewheel scroll",c),o.$on("remove",function(){angular.element(r).unbind("resize DOMMouseScroll mousewheel scroll",$),z.unbind("DOMMouseScroll mousewheel scroll",c),o.current.tour.config.mask.scrollThrough===!1&&x.all.unbind("DOMMouseScroll mousewheel scroll",i)}),o.tryStop=function(){o.current.tour.config.mask.clickExit&&o.stop()}}}}]),window.angular.extendDeep=function e(t){return angular.forEach(arguments,function(r){r!==t&&angular.forEach(r,function(r,o){t[o]&&t[o].constructor&&t[o].constructor===Object?e(t[o],r):t[o]=r})}),t}}();